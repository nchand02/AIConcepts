---
interface Props {
  title: string;
  description?: string;
  currentPage?: string;
}

const { title, description = "Comprehensive guide to Artificial Intelligence and Machine Learning", currentPage = "" } = Astro.props;
import.meta.env.BASE_URL;
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const chapters = [
  { title: "Foundations of AI", path: "/chapters/01-foundations" },
  { title: "Machine Learning", path: "/chapters/02-machine-learning" },
  { title: "Deep Learning", path: "/chapters/03-deep-learning" },
  { title: "Transformers", path: "/chapters/04-transformers" },
  { title: "Large Language Models", path: "/chapters/05-llms" },
  { title: "Generative AI", path: "/chapters/06-generative-ai" },
  { title: "Embeddings & Vector DBs", path: "/chapters/07-embeddings" },
  { title: "RAG Systems", path: "/chapters/08-rag" },
  { title: "Fine-Tuning", path: "/chapters/09-fine-tuning" },
  { title: "Multimodal AI", path: "/chapters/10-multimodal" },
  { title: "AI Agents & MCP", path: "/chapters/11-agents" },
  { title: "AI Tooling", path: "/chapters/12-tooling" },
  { title: "AI Infrastructure", path: "/chapters/13-infrastructure" },
  { title: "System Design", path: "/chapters/14-system-design" },
  { title: "Glossary", path: "/chapters/15-glossary" }
];
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <meta name="author" content="AI Learning Portal">
  <title>{title} | AI Learning Portal</title>
  
  <!-- Mermaid.js for diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    
    // Import central diagram theme configuration
    // Inline configuration based on src/config/diagramTheme.ts
    const diagramConfig = {
      lightTheme: {
        theme: 'base',
        themeVariables: {
          // Primary colors with WCAG AA compliance
          primaryColor: '#3b82f6',
          primaryTextColor: '#0f172a',
          primaryBorderColor: '#cbd5e1',
          
          // Background colors
          mainBkg: '#ffffff',
          secondaryBkg: '#f8fafc',
          tertiaryBkg: '#f8fafc',
          
          // Text and borders
          textColor: '#0f172a',
          lineColor: '#cbd5e1',
          border1: '#cbd5e1',
          border2: '#cbd5e1',
          
          // Node-specific colors
          nodeBorder: '#cbd5e1',
          nodeTextColor: '#0f172a',
          
          // Edge colors
          edgeLabelBackground: '#ffffff',
          
          // Cluster/group styling
          clusterBkg: '#f8fafc',
          clusterBorder: '#cbd5e1',
          
          // Semantic colors
          secondaryColor: '#10b981',
          tertiaryColor: '#f59e0b',
          
          // Typography
          fontSize: '15px',
          fontFamily: 'ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
        },
        flowchart: {
          htmlLabels: true,
          curve: 'basis',
          padding: 16,
          nodeSpacing: 64,
          rankSpacing: 56,
          diagramPadding: 32,
          useMaxWidth: true,
        },
      },
      darkTheme: {
        theme: 'base',
        themeVariables: {
          // Primary colors with WCAG AA compliance
          primaryColor: '#60a5fa',
          primaryTextColor: '#f1f5f9',
          primaryBorderColor: '#475569',
          
          // Background colors
          mainBkg: '#1e293b',
          secondaryBkg: '#334155',
          tertiaryBkg: '#334155',
          
          // Text and borders
          textColor: '#f1f5f9',
          lineColor: '#475569',
          border1: '#475569',
          border2: '#475569',
          
          // Node-specific colors
          nodeBorder: '#475569',
          nodeTextColor: '#f1f5f9',
          
          // Edge colors
          edgeLabelBackground: '#1e293b',
          
          // Cluster/group styling
          clusterBkg: '#334155',
          clusterBorder: '#475569',
          
          // Semantic colors
          secondaryColor: '#34d399',
          tertiaryColor: '#fbbf24',
          
          // Typography
          fontSize: '15px',
          fontFamily: 'ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
        },
        flowchart: {
          htmlLabels: true,
          curve: 'basis',
          padding: 16,
          nodeSpacing: 64,
          rankSpacing: 56,
          diagramPadding: 32,
          useMaxWidth: true,
        },
      },
    };
    
    // Get current theme
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const isDarkMode = currentTheme === 'dark';
    
    // Initialize Mermaid with comprehensive config
    const config = isDarkMode ? diagramConfig.darkTheme : diagramConfig.lightTheme;
    mermaid.initialize({ 
      startOnLoad: true,
      ...config,
      securityLevel: 'loose',
      logLevel: 'error',
    });
    
    // Add ARIA labels to diagrams for accessibility
    window.addEventListener('load', () => {
      document.querySelectorAll('.mermaid').forEach((el, index) => {
        if (!el.hasAttribute('role')) {
          el.setAttribute('role', 'img');
          el.setAttribute('aria-label', `Diagram ${index + 1}: Interactive concept visualization`);
        }
      });
    });
    
    // Update mermaid theme on theme change
    window.addEventListener('themechange', (e) => {
      const isDark = e.detail.theme === 'dark';
      const newConfig = isDark ? diagramConfig.darkTheme : diagramConfig.lightTheme;
      
      mermaid.initialize({
        startOnLoad: true,
        ...newConfig,
        securityLevel: 'loose',
        logLevel: 'error',
      });
      
      // Re-render all diagrams
      document.querySelectorAll('.mermaid').forEach(el => {
        const code = el.textContent;
        el.removeAttribute('data-processed');
        el.innerHTML = code;
      });
      mermaid.run();
    });
  </script>
  
  <link rel="stylesheet" href={`${base}/styles/global.css`}>
  <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`}>
</head>
<body>
  <div class="app-container">
    <!-- Navigation Header -->
    <header class="main-header">
      <div class="header-content">
        <div class="logo">
          <a href={`${base}/`}>
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
              <rect width="32" height="32" rx="8" fill="url(#gradient)"/>
              <path d="M16 8L22 12V20L16 24L10 20V12L16 8Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
              <circle cx="16" cy="16" r="3" fill="white"/>
              <defs>
                <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                  <stop offset="0%" stop-color="#3b82f6"/>
                  <stop offset="100%" stop-color="#8b5cf6"/>
                </linearGradient>
              </defs>
            </svg>
            <span>AI Learning Portal</span>
          </a>
        </div>
        
        <nav class="main-nav">
          <a href={`${base}/`} class={currentPage === "" ? "active" : ""}>Home</a>
          <a href={`${base}/chapters/01-foundations`} class={currentPage.startsWith("/chapters") ? "active" : ""}>Chapters</a>
          <a href="https://nchand02.github.io/bio/" target="_blank" rel="noopener">About Author</a>
          <a href="https://github.com/nchand02/AIConcepts" target="_blank" rel="noopener">GitHub</a>
        </nav>
        
        <div class="header-actions">
          <button id="search-toggle" class="icon-btn" aria-label="Search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
              <circle cx="8" cy="8" r="6" stroke-width="2"/>
              <path d="M13 13L18 18" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button id="theme-toggle" class="icon-btn" aria-label="Toggle theme">
            <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
              <circle cx="10" cy="10" r="4" stroke-width="2"/>
              <line x1="10" y1="2" x2="10" y2="4" stroke-width="2" stroke-linecap="round"/>
              <line x1="10" y1="16" x2="10" y2="18" stroke-width="2" stroke-linecap="round"/>
              <line x1="3.5" y1="3.5" x2="5" y2="5" stroke-width="2" stroke-linecap="round"/>
              <line x1="15" y1="15" x2="16.5" y2="16.5" stroke-width="2" stroke-linecap="round"/>
              <line x1="2" y1="10" x2="4" y2="10" stroke-width="2" stroke-linecap="round"/>
              <line x1="16" y1="10" x2="18" y2="10" stroke-width="2" stroke-linecap="round"/>
              <line x1="3.5" y1="16.5" x2="5" y2="15" stroke-width="2" stroke-linecap="round"/>
              <line x1="15" y1="5" x2="16.5" y2="3.5" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
            </svg>
          </button>
          <button id="mobile-menu-toggle" class="icon-btn mobile-only" aria-label="Menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <line x1="3" y1="6" x2="21" y2="6" stroke-width="2" stroke-linecap="round"/>
              <line x1="3" y1="12" x2="21" y2="12" stroke-width="2" stroke-linecap="round"/>
              <line x1="3" y1="18" x2="21" y2="18" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Search Modal -->
      <div id="search-modal" class="search-modal hidden">
        <div class="search-content">
          <input type="text" id="search-input" placeholder="Search documentation..." />
          <div id="search-results"></div>
        </div>
      </div>
    </header>

    <div class="content-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
          <h3>Chapters</h3>
          <nav class="chapter-nav">
            {chapters.map((chapter, index) => (
              <a 
                href={`${base}${chapter.path}`} 
                class={currentPage === chapter.path ? "active" : ""}
              >
                <span class="chapter-number">{String(index + 1).padStart(2, '0')}</span>
                <span class="chapter-title">{chapter.title}</span>
              </a>
            ))}
          </nav>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <div class="content-inner">
          <slot />
        </div>
        
        <!-- Footer -->
        <footer class="main-footer">
          <div class="footer-content">
            <p>&copy; {new Date().getFullYear()} AI Learning Portal. Open source educational resource.</p>
            <div class="footer-links">
              <a href="https://github.com/nchand02/AIConcepts" target="_blank">GitHub</a>
              <a href="https://github.com/nchand02/AIConcepts/issues" target="_blank">Report Issue</a>
              <a href="https://github.com/nchand02/AIConcepts/blob/main/LICENSE" target="_blank">License</a>
            </div>
          </div>
        </footer>
      </main>
    </div>
  </div>

  <!-- Scripts -->
  <script is:inline src={`${base}/scripts/main.js`}></script>
  <script is:inline>
    // Initialize theme
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
  </script>
</body>
</html>
